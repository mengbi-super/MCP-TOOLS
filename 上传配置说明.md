# PyPI Token 配置说明

## ⚠️ 重要提示

**Token 是敏感信息，绝对不能提交到 Git 仓库！**

## 推荐方式：使用 .pypirc 文件

### Windows 系统

1. **创建配置文件**

   在用户主目录创建 `.pypirc` 文件：
   - 路径：`C:\Users\你的用户名\.pypirc`
   - 或者使用环境变量：`%USERPROFILE%\.pypirc`

2. **文件内容**

   ```ini
   [pypi]
   username = __token__
   password = pypi-你的token
   ```

3. **使用方法**

   配置好后，直接运行：
   ```bash
   py -m twine upload dist/*
   ```
   无需再输入用户名和密码。

### Linux/Mac 系统

1. **创建配置文件**

   在用户主目录创建 `.pypirc` 文件：
   ```bash
   ~/.pypirc
   ```

2. **设置权限（重要）**

   ```bash
   chmod 600 ~/.pypirc
   ```
   确保只有你可以读写此文件。

3. **文件内容**

   同 Windows 系统。

## 方式二：使用环境变量

### Windows PowerShell

```powershell
# 临时设置（当前会话有效）
$env:TWINE_USERNAME="__token__"
$env:TWINE_PASSWORD="pypi-你的token"
py -m twine upload dist/*
```

### Windows CMD

```cmd
set TWINE_USERNAME=__token__
set TWINE_PASSWORD=pypi-你的token
py -m twine upload dist/*
```

### Linux/Mac

```bash
export TWINE_USERNAME="__token__"
export TWINE_PASSWORD="pypi-你的token"
python -m twine upload dist/*
```

## 方式三：使用 .env 文件（不推荐用于 PyPI）

如果使用 `.env` 文件，确保：

1. 在项目根目录创建 `.env` 文件
2. 添加到 `.gitignore`（已包含）
3. 内容：
   ```
   TWINE_USERNAME=__token__
   TWINE_PASSWORD=pypi-你的token
   ```

## 快速设置步骤

### Windows 快速设置

```powershell
# 1. 复制示例文件到用户主目录
Copy-Item .pypirc.example $env:USERPROFILE\.pypirc

# 2. 编辑文件，替换 token
notepad $env:USERPROFILE\.pypirc

# 3. 上传（无需输入密码）
py -m twine upload dist/*
```

### Linux/Mac 快速设置

```bash
# 1. 复制示例文件到用户主目录
cp .pypirc.example ~/.pypirc

# 2. 设置权限
chmod 600 ~/.pypirc

# 3. 编辑文件，替换 token
nano ~/.pypirc

# 4. 上传（无需输入密码）
python -m twine upload dist/*
```

## 验证配置

运行以下命令测试配置是否正确：

```bash
py -m twine check dist/*
```

如果配置正确，上传时不会提示输入用户名和密码。

## 安全建议

1. ✅ **使用 .pypirc 文件**（放在用户主目录，不在项目目录）
2. ✅ **设置文件权限**（Linux/Mac: `chmod 600`）
3. ✅ **不要提交 token 到 Git**
4. ✅ **定期轮换 token**（在 PyPI 账户设置中）
5. ✅ **使用项目级别的 token**（而不是账户级别的 token）

## 获取 Token

1. 登录 https://pypi.org/
2. 进入 Account settings → API tokens
3. 创建新的 API token
4. 复制 token（只显示一次，请妥善保存）

## 故障排除

### 问题：仍然提示输入密码

**解决方案：**
- 检查 `.pypirc` 文件路径是否正确
- 检查文件内容格式是否正确
- 尝试使用环境变量方式

### 问题：权限错误（Linux/Mac）

**解决方案：**
```bash
chmod 600 ~/.pypirc
```

### 问题：Token 无效

**解决方案：**
- 检查 token 是否以 `pypi-` 开头
- 确认 token 未过期
- 重新生成 token
